# 用户数据注入（可选）<a name="bms_01_0021"></a>

## 使用场景<a name="section114413173019"></a>

当您有如下需求时，可以考虑使用用户数据注入功能来配置裸金属服务器：

-   通过脚本简化裸金属服务器配置
-   通过脚本初始化系统
-   已有脚本，在创建裸金属服务器时一并上传至服务器
-   其他可以使用脚本完成的操作

## 使用限制<a name="section152433348328"></a>

-   Linux：
    -   用于创建裸金属服务器的镜像安装了Cloud-init组件。
    -   用户数据大小限制：小于等于32KB。
    -   如果通过文本方式上传用户数据，数据只能包含ASCII码字符；如果通过文件方式上传用户数据，可以包含任意字符。

-   Windows：
    -   用于创建裸金属服务器的镜像安装了Cloudbase-init组件。
    -   用户数据大小限制：小于等于32KB。
    -   如果通过文本方式上传用户数据，数据只能包含ASCII码字符；如果通过文件方式上传用户数据，可以包含任意字符。


## 使用方法<a name="section1864520172424"></a>

1.  根据实际需要编写Cloud-config脚本，脚本格式必须符合Cloud-config脚本规范，详细规范请参见[相关链接](#section1753215178819)。
2.  创建裸金属服务器时，需要将Cloud-config脚本内容粘贴到用户数据注入的文本框，或者选择Cloud-config文件上传。
3.  系统创建裸金属服务器，裸金属服务器启动后自动执行Cloud-init或Cloudbase-init组件，运行Cloud-config脚本。

## 样例一<a name="section6298124315470"></a>

该样例介绍如何通过用户数据注入，简化裸金属服务器配置。

当您需要设置vim的“语法高亮显示”、“制表符占用4个空格”和“显示行数”属性时，就可以写一个脚本vimrc，并将其注入到“/root/.vimrc”。在您创建裸金属服务器时，您的vim配置便完成了。这样做可以大幅提高系统配置的效率，特别是在您一次性创建多台裸金属服务器时。

用户数据注入示例：

```
#cloud-config
write_files:
  - path: /root/.vimrc
    content: |
      syntax on
      set tabstop=4
      set number      
```

## 样例二<a name="section93711419175416"></a>

该样例介绍如何通过用户数据注入，重置Linux裸金属服务器密码。

假设您需要将root用户密码重置为“\*\*\*\*\*\*”。

>![](public_sys-resources/icon-note.gif) **说明：**   
>新密码必须符合密码复杂度要求，密码规则如[表1](#table17998105810568)所示。  

**表 1**  密码规则

<a name="table17998105810568"></a>
<table><thead align="left"><tr id="row169981758195617"><th class="cellrowborder" valign="top" width="20%" id="mcps1.2.4.1.1"><p id="p18998155814569"><a name="p18998155814569"></a><a name="p18998155814569"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="60%" id="mcps1.2.4.1.2"><p id="p299925805610"><a name="p299925805610"></a><a name="p299925805610"></a>规则</p>
</th>
<th class="cellrowborder" valign="top" width="20%" id="mcps1.2.4.1.3"><p id="p69991585565"><a name="p69991585565"></a><a name="p69991585565"></a>样例</p>
</th>
</tr>
</thead>
<tbody><tr id="row11999115816565"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.4.1.1 "><p id="p199975816561"><a name="p199975816561"></a><a name="p199975816561"></a>密码</p>
</td>
<td class="cellrowborder" valign="top" width="60%" headers="mcps1.2.4.1.2 "><a name="ul887614358573"></a><a name="ul887614358573"></a><ul id="ul887614358573"><li>密码长度范围为8到26位。</li><li>密码至少包含以下4种字符中的3种：<a name="ul16512152335816"></a><a name="ul16512152335816"></a><ul id="ul16512152335816"><li>大写字母</li><li>小写字母</li><li>数字</li><li>特殊字符，包括!@$%^-_=+[]{}:,./?</li></ul>
</li><li>密码不能包含用户名或用户名的逆序。</li><li>Windows系统的裸金属服务器，不能包含用户名中超过两个连续字符的部分。</li></ul>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.4.1.3 "><p id="p699916580568"><a name="p699916580568"></a><a name="p699916580568"></a>Test12$@</p>
</td>
</tr>
</tbody>
</table>

用户数据注入示例（请严格遵守下面示例中的缩进标准）：

```
#cloud-config
chpasswd:
  list: |
    root:******
  expire: False
```

裸金属服务器创建成功后，您可以使用重置的密码登录裸金属服务器。为了保证密码安全，建议您在第一次登录裸金属服务器后，修改root用户密码。

## 样例三<a name="section12403842045"></a>

该样例介绍如何通过用户数据注入，为Windows裸金属服务器新增用户并设置密码。

假设您要创建的用户名为“abc”、密码为“\*\*\*\*\*\*”普通用户，并将其添加至administrators用户组。

>![](public_sys-resources/icon-note.gif) **说明：**   
>新密码必须符合密码复杂度要求，密码规则如[表2](#table82807424619)所示。  

**表 2**  密码规则

<a name="table82807424619"></a>
<table><thead align="left"><tr id="bms_01_0021_row169981758195617"><th class="cellrowborder" valign="top" width="20%" id="mcps1.2.4.1.1"><p id="bms_01_0021_p18998155814569"><a name="bms_01_0021_p18998155814569"></a><a name="bms_01_0021_p18998155814569"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="60%" id="mcps1.2.4.1.2"><p id="bms_01_0021_p299925805610"><a name="bms_01_0021_p299925805610"></a><a name="bms_01_0021_p299925805610"></a>规则</p>
</th>
<th class="cellrowborder" valign="top" width="20%" id="mcps1.2.4.1.3"><p id="bms_01_0021_p69991585565"><a name="bms_01_0021_p69991585565"></a><a name="bms_01_0021_p69991585565"></a>样例</p>
</th>
</tr>
</thead>
<tbody><tr id="bms_01_0021_row11999115816565"><td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.4.1.1 "><p id="bms_01_0021_p199975816561"><a name="bms_01_0021_p199975816561"></a><a name="bms_01_0021_p199975816561"></a>密码</p>
</td>
<td class="cellrowborder" valign="top" width="60%" headers="mcps1.2.4.1.2 "><a name="bms_01_0021_ul887614358573"></a><a name="bms_01_0021_ul887614358573"></a><ul id="bms_01_0021_ul887614358573"><li>密码长度范围为8到26位。</li><li>密码至少包含以下4种字符中的3种：<a name="bms_01_0021_ul16512152335816"></a><a name="bms_01_0021_ul16512152335816"></a><ul id="bms_01_0021_ul16512152335816"><li>大写字母</li><li>小写字母</li><li>数字</li><li>特殊字符，包括!@$%^-_=+[]{}:,./?</li></ul>
</li><li>密码不能包含用户名或用户名的逆序。</li><li>Windows系统的裸金属服务器，不能包含用户名中超过两个连续字符的部分。</li></ul>
</td>
<td class="cellrowborder" valign="top" width="20%" headers="mcps1.2.4.1.3 "><p id="bms_01_0021_p699916580568"><a name="bms_01_0021_p699916580568"></a><a name="bms_01_0021_p699916580568"></a>Test12$@</p>
</td>
</tr>
</tbody>
</table>

用户数据注入示例：

```
rem cmd
net user abc ****** /add
net localgroup administrators abc /add
```

裸金属服务器创建成功后，您可以使用新创建的用户名和密码登录裸金属服务器。

## 相关链接<a name="section1753215178819"></a>

更多使用场景的介绍，请参见Cloud-init/Cloudbase-init官网：

-   [https://cloudinit.readthedocs.io/en/latest/](https://cloudinit.readthedocs.io/en/latest/)

-   [https://cloudbase-init.readthedocs.io/en/latest/](https://cloudbase-init.readthedocs.io/en/latest/)

