# 配置安全组<a name="zh-cn_topic_0028313245"></a>

## 添加安全组规则<a name="section65020802162416"></a>

安全组的默认规则是在出方向上的数据报文全部放行，安全组内的裸金属服务器无需添加规则即可互相访问。安全组创建后，您可以在安全组中定义各种访问规则，当裸金属服务器加入该安全组后，即受到这些访问规则的保护。

>![](public_sys-resources/icon-note.gif) **说明：**   
>在创建裸金属服务器时只能添加一个安全组。裸金属服务器创建完成后，可以在详情页面修改每个网卡对应的安全组。  

当需要从安全组外访问安全组内的裸金属服务器时，需要为安全组添加相应的入方向规则。建议将不同公网访问策略的裸金属服务器划分到不同的安全组。

>![](public_sys-resources/icon-note.gif) **说明：**   
>源地址默认的IP地址0.0.0.0/0是指允许所有IP地址访问安全组内的裸金属服务器。  

1.  登录管理控制台。
2.  单击管理控制台左上角的![](figures/icon-region.png)，选择地域和项目。
3.  在系统首页，单击“计算 \> 裸金属服务器”。
4.  在裸金属服务器列表，单击待变更安全组规则的裸金属服务器名称。

    系统跳转至该裸金属服务器详情页面。

5.  选择“安全组”页签，并单击![](figures/icon-show.png)，查看安全组规则。
6.  单击安全组ID。

    系统自动跳转至安全组页面。

7.  单击操作列的“配置规则”，在安全组详情页根据安全组规则生效的方向添加规则，相关参数说明如[表1](#table335513383514)所示。

    安全组规则生效的方向包括入方向和出方向：入方向指从外表进入安全组的流量，出方向指从安全组内出去的流量。

    **表 1**  参数说明

    <a name="table335513383514"></a>
    <table><thead align="left"><tr id="row203581133123514"><th class="cellrowborder" valign="top" width="29.439999999999998%" id="mcps1.2.4.1.1"><p id="p6359123319355"><a name="p6359123319355"></a><a name="p6359123319355"></a><strong id="b1335973373510"><a name="b1335973373510"></a><a name="b1335973373510"></a>参数</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="54.459999999999994%" id="mcps1.2.4.1.2"><p id="p03602336359"><a name="p03602336359"></a><a name="p03602336359"></a><strong id="b03608333359"><a name="b03608333359"></a><a name="b03608333359"></a>说明</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="16.1%" id="mcps1.2.4.1.3"><p id="p536113334353"><a name="p536113334353"></a><a name="p536113334353"></a><strong id="b17361183393514"><a name="b17361183393514"></a><a name="b17361183393514"></a>取值样例</strong></p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row73621433103510"><td class="cellrowborder" valign="top" width="29.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p1236312336353"><a name="p1236312336353"></a><a name="p1236312336353"></a>协议</p>
    </td>
    <td class="cellrowborder" valign="top" width="54.459999999999994%" headers="mcps1.2.4.1.2 "><p id="p193631337352"><a name="p193631337352"></a><a name="p193631337352"></a>网络协议，取值范围为：TCP，UDP，ICMP、HTTP等等。</p>
    </td>
    <td class="cellrowborder" valign="top" width="16.1%" headers="mcps1.2.4.1.3 "><p id="p14364833153520"><a name="p14364833153520"></a><a name="p14364833153520"></a>TCP</p>
    </td>
    </tr>
    <tr id="row123671533143517"><td class="cellrowborder" valign="top" width="29.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p8367133123514"><a name="p8367133123514"></a><a name="p8367133123514"></a>端口</p>
    </td>
    <td class="cellrowborder" valign="top" width="54.459999999999994%" headers="mcps1.2.4.1.2 "><p id="p2367153383514"><a name="p2367153383514"></a><a name="p2367153383514"></a>规则的端口或端口范围，取值范围为：0～65535。</p>
    </td>
    <td class="cellrowborder" valign="top" width="16.1%" headers="mcps1.2.4.1.3 "><p id="p1536873320355"><a name="p1536873320355"></a><a name="p1536873320355"></a>22或22-30</p>
    </td>
    </tr>
    <tr id="row2368183363513"><td class="cellrowborder" valign="top" width="29.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p1036913339351"><a name="p1036913339351"></a><a name="p1036913339351"></a>源地址</p>
    </td>
    <td class="cellrowborder" valign="top" width="54.459999999999994%" headers="mcps1.2.4.1.2 "><p id="p5369143343516"><a name="p5369143343516"></a><a name="p5369143343516"></a>当方向为入方向时，需要填入此参数。源地址可以是IP地址，也可以是安全组。</p>
    </td>
    <td class="cellrowborder" valign="top" width="16.1%" headers="mcps1.2.4.1.3 "><p id="p537013313356"><a name="p537013313356"></a><a name="p537013313356"></a>0.0.0.0/0</p>
    <p id="p14371133333513"><a name="p14371133333513"></a><a name="p14371133333513"></a>default</p>
    </td>
    </tr>
    <tr id="row337112338359"><td class="cellrowborder" valign="top" width="29.439999999999998%" headers="mcps1.2.4.1.1 "><p id="p113725338352"><a name="p113725338352"></a><a name="p113725338352"></a>目的地址</p>
    </td>
    <td class="cellrowborder" valign="top" width="54.459999999999994%" headers="mcps1.2.4.1.2 "><p id="p137316337354"><a name="p137316337354"></a><a name="p137316337354"></a>当方向是出方向时，需要填入此参数。目的地址可以是IP地址，也可以是安全组。</p>
    </td>
    <td class="cellrowborder" valign="top" width="16.1%" headers="mcps1.2.4.1.3 "><p id="p937418336358"><a name="p937418336358"></a><a name="p937418336358"></a>0.0.0.0/0</p>
    <p id="p43759338358"><a name="p43759338358"></a><a name="p43759338358"></a>default</p>
    </td>
    </tr>
    </tbody>
    </table>


## 裸金属服务器的安全组配置案例<a name="section95114385408"></a>

实际应用中，请根据实际网络环境需求，对安全组进行配置。我们提供以下几种常见的安全组配置案例作为参考。

-   **案例一：不同安全组内的裸金属服务器内网互通**
    -   场景举例

        在相同Region的相同帐号下，用户需要将某个安全组内一台裸金属服务器上的资源拷贝到另一个安全组内的裸金属服务器上时， 可以将两台裸金属服务器设置为内网互通后再拷贝资源。

    -   安全组配置方法

        由于相同Region的相同帐号下，在同一个安全组内的裸金属服务器默认互通，无需配置。但是，在不同安全组内的裸金属服务器默认无法通信，此时需要添加安全组规则，使得不同安全组内的裸金属服务器内网互通。

        在两台裸金属服务器所在安全组中分别添加一条入方向安全组规则，放通来自另一个安全组内的实例的访问，实现内网互通，安全组规则如下所示。

        <a name="table58694119222"></a>
        <table><thead align="left"><tr id="row1087231120228"><th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.1"><p id="p38731117224"><a name="p38731117224"></a><a name="p38731117224"></a>协议</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.2"><p id="p18874111152218"><a name="p18874111152218"></a><a name="p18874111152218"></a>方向</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.3"><p id="p198751711112218"><a name="p198751711112218"></a><a name="p198751711112218"></a>端口范围/ICMP协议类型</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.4"><p id="p987612111223"><a name="p987612111223"></a><a name="p987612111223"></a>源地址</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row108771811102212"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.1 "><p id="p1987841117228"><a name="p1987841117228"></a><a name="p1987841117228"></a>设置内网互通时使用的协议类型（支持TCP/UDP/ICMP/ANY）</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.2 "><p id="p78795112226"><a name="p78795112226"></a><a name="p78795112226"></a>入方向</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.3 "><p id="p1988081172215"><a name="p1988081172215"></a><a name="p1988081172215"></a>设置端口范围或者ICMP协议类型</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.4 "><p id="p8881141152212"><a name="p8881141152212"></a><a name="p8881141152212"></a>IPv4地址、IPv4 CIDR或者另一个安全组的ID</p>
        </td>
        </tr>
        </tbody>
        </table>

        >![](public_sys-resources/icon-note.gif) **说明：**   
        >源地址可以配置为CIDR（仅支持IPv4），也可以配置为安全组ID。如果想将目的地址配置成某个具体的IP地址，需将CIDR的子网掩码长度设置成32位。  


-   **案例二：仅允许特定IP地址远程登录裸金属服务器**
    -   场景举例

        为了防止裸金属服务器被网络攻击，用户可以修改远程登录端口号，并设置安全组规则只允许特定的IP地址远程登录到裸金属服务器。

    -   安全组配置方法

        以仅允许特定IP地址（例如，192.168.20.2）通过TCP协议访问Linux操作系统的裸金属服务器的22端口为例，安全组规则如下所示。

        <a name="table939592217292"></a>
        <table><thead align="left"><tr id="row14399112282913"><th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.1"><p id="p640011222298"><a name="p640011222298"></a><a name="p640011222298"></a>协议</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.2"><p id="p240119228296"><a name="p240119228296"></a><a name="p240119228296"></a>方向</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.3"><p id="p1640292262913"><a name="p1640292262913"></a><a name="p1640292262913"></a>端口范围</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.4"><p id="p144030224297"><a name="p144030224297"></a><a name="p144030224297"></a>源地址</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row740482282910"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.1 "><p id="p1740502282911"><a name="p1740502282911"></a><a name="p1740502282911"></a>TCP</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.2 "><p id="p114068223298"><a name="p114068223298"></a><a name="p114068223298"></a>入方向</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.3 "><p id="p20407172272919"><a name="p20407172272919"></a><a name="p20407172272919"></a>22</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.4 "><p id="p144081922162913"><a name="p144081922162913"></a><a name="p144081922162913"></a>IPv4地址、IPv4 CIDR或者另一个安全组的ID。</p>
        <p id="p1914761211308"><a name="p1914761211308"></a><a name="p1914761211308"></a>例如：192.168.20.2</p>
        </td>
        </tr>
        </tbody>
        </table>


-   **案例三：允许任意公网IP地址远程登录裸金属服务器**
    -   场景举例

        允许Internet的任意地址远程登录到安全组内的裸金属服务器。

    -   安全组配置方法

        以允许任意公网地址通过TCP协议登录Linux操作系统的裸金属服务器为例，安全组规则如下所示。

        <a name="table7472173173217"></a>
        <table><thead align="left"><tr id="row1477123112321"><th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.1"><p id="p1247993123217"><a name="p1247993123217"></a><a name="p1247993123217"></a>协议</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.2"><p id="p1648063115322"><a name="p1648063115322"></a><a name="p1648063115322"></a>方向</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.3"><p id="p2048273115322"><a name="p2048273115322"></a><a name="p2048273115322"></a>端口范围</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.4"><p id="p1748317311328"><a name="p1748317311328"></a><a name="p1748317311328"></a>源地址</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row24841031133218"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.1 "><p id="p1485631203213"><a name="p1485631203213"></a><a name="p1485631203213"></a>TCP</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.2 "><p id="p15487931133215"><a name="p15487931133215"></a><a name="p15487931133215"></a>入方向</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.3 "><p id="p17488203111326"><a name="p17488203111326"></a><a name="p17488203111326"></a>22</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.4 "><p id="p1348953193218"><a name="p1348953193218"></a><a name="p1348953193218"></a>0.0.0.0/0</p>
        </td>
        </tr>
        </tbody>
        </table>

        以允许任意公网地址通过TCP协议登录Windows操作系统的裸金属服务器为例，安全组规则如下所示。

        <a name="table1385517143311"></a>
        <table><thead align="left"><tr id="row588161714332"><th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.1"><p id="p16897172333"><a name="p16897172333"></a><a name="p16897172333"></a>协议</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.2"><p id="p179081717336"><a name="p179081717336"></a><a name="p179081717336"></a>方向</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.3"><p id="p109261743314"><a name="p109261743314"></a><a name="p109261743314"></a>端口范围</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.4"><p id="p119341783314"><a name="p119341783314"></a><a name="p119341783314"></a>源地址</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row1994141717331"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.1 "><p id="p199691712336"><a name="p199691712336"></a><a name="p199691712336"></a>TCP</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.2 "><p id="p11971117113318"><a name="p11971117113318"></a><a name="p11971117113318"></a>入方向</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.3 "><p id="p1898117103317"><a name="p1898117103317"></a><a name="p1898117103317"></a>3389</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.4 "><p id="p129919171330"><a name="p129919171330"></a><a name="p129919171330"></a>0.0.0.0/0</p>
        </td>
        </tr>
        </tbody>
        </table>


-   **案例四：允许公网地址通过HTTP或者HTTPS协议访问裸金属服务器**
    -   场景举例

        在裸金属服务器上部署网站后，允许Internet的任意IP地址的用户通过HTTP或者HTTPS协议访问安全组内的裸金属服务器。

    -   安全组配置方法

        不限制公网地址访问裸金属服务器，需要配置的两条安全组规则如下所示。

        <a name="table851372711364"></a>
        <table><thead align="left"><tr id="row195196275365"><th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.1"><p id="p4521102763617"><a name="p4521102763617"></a><a name="p4521102763617"></a>协议</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.2"><p id="p155231278365"><a name="p155231278365"></a><a name="p155231278365"></a>方向</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.3"><p id="p145251627123611"><a name="p145251627123611"></a><a name="p145251627123611"></a>端口范围</p>
        </th>
        <th class="cellrowborder" valign="top" width="25%" id="mcps1.1.5.1.4"><p id="p4527172711369"><a name="p4527172711369"></a><a name="p4527172711369"></a>源地址</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="row1252913270365"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.1 "><p id="p18530122783618"><a name="p18530122783618"></a><a name="p18530122783618"></a>TCP</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.2 "><p id="p35322027143619"><a name="p35322027143619"></a><a name="p35322027143619"></a>入方向</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.3 "><p id="p145335278361"><a name="p145335278361"></a><a name="p145335278361"></a>80（HTTP）</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.4 "><p id="p7535102718364"><a name="p7535102718364"></a><a name="p7535102718364"></a>0.0.0.0/0</p>
        </td>
        </tr>
        <tr id="row134093943613"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.1 "><p id="p11341239103620"><a name="p11341239103620"></a><a name="p11341239103620"></a>TCP</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.2 "><p id="p143413391368"><a name="p143413391368"></a><a name="p143413391368"></a>入方向</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.3 "><p id="p1534112393361"><a name="p1534112393361"></a><a name="p1534112393361"></a>443（HTTPS）</p>
        </td>
        <td class="cellrowborder" valign="top" width="25%" headers="mcps1.1.5.1.4 "><p id="p1634103963611"><a name="p1634103963611"></a><a name="p1634103963611"></a>0.0.0.0/0</p>
        </td>
        </tr>
        </tbody>
        </table>



